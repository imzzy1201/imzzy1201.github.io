<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    imzzy1201&#39;s Blog
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="imzzy 1201">
<!-- <meta name="description" content=""> -->
<meta name="keywords" content="">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://imzzy1201.github.io//media/css/style.css" />
<link rel="stylesheet" href="https://imzzy1201.github.io//styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="https://imzzy1201.github.io//media/script/tocbot.min.js"></script>
<script src="https://imzzy1201.github.io//media/script/script.min.js"></script>
<script src="https://imzzy1201.github.io//media/script/icon.min.js"></script>
<script src="https://imzzy1201.github.io//media/script/prism.min.js"></script>
<link rel="stylesheet" href="https://imzzy1201.github.io//media/css/prism.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>

            <!--CDN样式-->
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
            <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
            
                <script>
                    (function() {
                        var bp = document.createElement('script');
                        var curProtocol = window.location.protocol.split(':')[0];
                        if (curProtocol === 'https') {
                            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                        } else {
                            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                        }
                        var s = document.getElementsByTagName("script")[0];
                        s.parentNode.insertBefore(bp, s);
                    })();
                </script>
                
                    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166330324-1"></script>
                    <script>
                        window.dataLayer = window.dataLayer || [];

                        function gtag() {
                            dataLayer.push(arguments);
                        }
                        gtag('js', new Date());
                        gtag('config', 'UA-166330324-1');
                    </script>
                    
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://imzzy1201.github.io/">
                    imzzy1201&#39;s Blog
                </a>
            </div>

            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        首页
                    </a>
                    
                    <a class="menu-item" href="/posts/">
                        文章
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        归档
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        标签
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        关于
                    </a>
                    
                    <a class="menu-item" href="/post/friends">
                        友链
                    </a>
                    
                    <a class="menu-item" href="https://github.com/imzzy1201">
                        My GitHub
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1595751304641" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://imzzy1201.github.io/">
                            imzzy1201&#39;s Blog
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1595751304641" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            首页
                        </a>
                        
                        <a class="menu-item" href="/posts/">
                            文章
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            归档
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            标签
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            关于
                        </a>
                        
                        <a class="menu-item" href="/post/friends">
                            友链
                        </a>
                        
                        <a class="menu-item" href="https://github.com/imzzy1201">
                            My GitHub
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                关于平衡树
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        imzzy1201
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-07-18</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">13.3
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">3564</a></span>
                                    
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                        <div class="post-content">
                            <blockquote>
<p>Never trouble trouble till trouble troubles you.</p>
</blockquote>
<!-- more -->
<p><s>声明：跟那篇神贴没有任何关系</s>（雾</p>
<p>此篇用来总结我学过的各种各样的自平衡二叉查找树。</p>
<h1 id="平衡树">平衡树</h1>
<p>一般大家所说的平衡树指的一类优化的二叉查找树。一般的二叉查找树的查询复杂度取决于目标结点到树根的距离（即深度），因此当结点的深度普遍较大时，查询的均摊复杂度会上升。为了实现更高效的查询，产生了平衡树。平衡指所有叶子的深度趋于平衡，能在非常优的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 时间内完成对一个数列完成插入、删除、查询前驱后继和排名等操作。</p>
<p>狭义的平衡树指任意节点的左右子树高度差不大于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的二叉查找树。满足狭义平衡树性质的数据结构其实很少，基本上只有 AVL。</p>
<p>广义的平衡树把狭义平衡树推广为，对于一系列的操作，可以实现 <strong>严格/期望/均摊 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></strong> 的优化二叉查找树。广义平衡树的种类就很多了，比如红黑树、伸展树、树堆、替罪羊树、加权平衡树等等。</p>
<p>此篇中以后出现的“平衡树”将均指广义平衡树。</p>
<h1 id="概述">概述</h1>
<p>大部分平衡树是基于三类操作的：</p>
<ol>
<li>旋转<br>
大致来说，旋转就是指将一个节点“转”到它的父节点，而这个父节点则被贬为了它的子节点。这个操作后面会重点讲的。事实上，只有很少的个别几种平衡树不是使用旋转来保证复杂度的。</li>
<li>重构<br>
重构指的就是对一个子树重新构建，使得这个子树内部平衡。</li>
<li>分裂、合并<br>
致敬 fhq-treap</li>
</ol>
<p>先简述一下将要介绍的和不准备介绍的那些平衡树的特征。</p>
<ul>
<li>树堆<br>
树堆（Treap）是一种基于旋转的二叉查找树。可以说它是一种支持动态插入的笛卡尔树。对于每个关键字，都会对应一个“优先级”。Treap 这个名字其实就是由 Tree 和 Heap 合成的，它通过旋转来同时维护两个性质：1. 关键字满足二叉查找树的性质；2. 优先级满足堆的性质。关键字的优先级取随机数可以使 Treap 的操作达到期望 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>。<br>
Treap 的思想清晰、简单，实现与普通的二叉查找树区别较小，代码量较小（与普通二叉查找树只在插入、删除中有少量差别），而且从真实效率上来讲非常优秀。推荐初学平衡树的同学最先接触 Treap。
<ul>
<li>FHQ-Treap<br>
FHQ-Treap 是 FHQ（范浩强）神犇发明的一种基本思想与 Treap 相同的平衡树。它同样要求维护关键字的二叉查找树性质和优先级的堆性质。与普通 Treap 不同的是，它使用另一种操作——分裂、合并，来完成这个性质的维护。它的效率与 Treap 相近；因其独特的分裂、合并操作而使它实现中可以简化一些二叉查找树的基本操作，所以代码量也较小；然后另一个非常重要的地方是它能可持久化（许多基于旋转的平衡树并不易于函数式编程），大部分“可持久化平衡树”都是用它作为原型实现的。</li>
</ul>
</li>
<li>伸展树<br>
伸展树（Splay）也是一一种基于旋转的二叉查找树。它的基本思想是在每一次操作后将被操作的节点通过一系列的旋转转到根节点。利用势能分析可以证明其复杂度是均摊 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的（或者说能花费 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>m</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的时间完成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> 次操作）。<br>
Splay 的核心操作就是伸展（splay），它可以分为“双旋”和“单旋”，事实上“单旋”的伸展操作复杂度不能保证均摊 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>。<br>
Splay 的常数会比 Treap 略大；但因其核心操作 splay 非常灵活，所以在许多地方都有无法的用处；实现也并不复杂。推荐学完 Treap 后紧接着就可以学 Splay 了。</li>
<li>替罪羊树<br>
替罪羊树则是少数几个基于重构的平衡树之一。它的本质思想就是碰到非常不平衡的节点就拍扁重建。它的核心是“非常不平衡”的定义、“替罪羊节点”（即要对其子树进行重构的节点）的定义和排便重构的过程。<br>
与 Treap 类似的，除了插入、删除，替罪羊树的操作也都与普通二叉查找树相同；从代码实现上来说会稍微复杂一点；效率还未知（待补）
<ul>
<li>朝鲜树<br>
<s>名字是个幌子</s>（雾<br>
朝鲜树完全可以看作简化+劣化的替罪羊树，其时间复杂度无法保证任何形式的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>，没啥学的意义。</li>
</ul>
</li>
<li>AVL 树<br>
AVL 树是最先提出来的平衡树了，也是狭义平衡树的代表。它通过一系列的旋转操作保证了二叉搜索树严格平衡。它通过引入“平衡因子”（即左右子树高度差），从深到浅对平衡性不正确的节点（即平衡因子为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∓</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\mp2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">∓</span><span class="mord">2</span></span></span></span> 的节点）执行“AVL旋转”来使它恢复平衡。<br>
这种爷爷辈平衡树在实用中并不常见，但具有非常高的理论价值。</li>
<li>红黑树<br>
大名鼎鼎的红黑树（RBT），可以算最快的一种平衡树了。简单来说，它将所有节点分为了红、黑两种，红黑两类节点间满足一些性质。通过用旋转维护这些性质，可以使红黑树的最深的叶节点和最浅的叶节点的深度比在 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>∼</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\dfrac{1}{2}\sim2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 之间。对一次插入，红黑树会至多更改 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 个节点的颜色和进行 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 次旋转；对一次删除，红黑树也至多更改 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 个节点的颜色、进行 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> 次旋转。<br>
然而，红黑树的实现非常复杂，不适合运用在算法竞赛中。<br>
当然，红黑树在工程里的用途还是很广泛的。比如 C++ 的 STL 中 <code>set</code> 和 <code>map</code> 就是用红黑树实现的，Linux 系统的进程管理、内存管理也用到了红黑树。同时，红黑树也经常用在函数式编程中。
<ul>
<li>AA 树<br>
AA 树是红黑树的一个变种，其简化了红黑树的实现方法。它最鲜明的特征就是所有红节点都不是左儿子，这个性质使得它实现起来更加简便</li>
<li>左偏红黑树<br>
左偏红黑树（LLRB）也是红黑树的一个变种，它也是对红点的位置做了一些限制，使其较普通红黑树而言更容易实现。</li>
</ul>
</li>
<li>加权平衡树<br>
加权平衡树（Weight-Balanced Binary Trees, WBTs）通过与 AVL 树类似的操作维护使得所有节点的左右子树节点数的比值不超过一个常数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi><mtext> </mtext><mo>(</mo><mi>α</mi><mo>&lt;</mo><mn>1</mn><mo>−</mo><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac><mo>)</mo></mrow><annotation encoding="application/x-tex">\alpha\ (\alpha&lt;1-\dfrac{1}{\sqrt{2}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.25144em;vertical-align:-0.93em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></li>
<li>B 树<br>
B 树本来是平衡的多叉树，但也可以以二叉查找树的形式出现。其应用大多在数据库和文件系统上。
<ul>
<li>2-3 树，2-3-4 树<br>
都是特例化的 B 树。</li>
</ul>
</li>
<li>节点大小平衡树<br>
<s>就是神贴里争论的是否属于平衡树的那个可怜的数据结构</s>（雾<br>
节点大小平衡树（SBT）用旋转维护“节点大小”平衡，被其发明人陈启峰称为“目前为止速度最快的高级二叉搜索树”，但真实性存疑，并且可能退化。</li>
</ul>
<h1 id="平衡树基础">平衡树基础</h1>
<h2 id="二叉查找树">二叉查找树</h2>
<p>这算是前置知识了，这里不再详述。大部分平衡树的操作还是跟普通二叉查找树紧密结合的，少部分因其独特的操作和性质，所以也可以将二叉查找树的基本操作简化一些。</p>
<p>这里先给出几个二叉查找树重要的操作定义以便讲解后面平衡树的几个基本定义和操作。</p>
<p><strong>节点</strong>：<br>
我们一般将节点定义在结构体中，最常规的二叉查找树将维护以下几个值：</p>
<ol>
<li><code>father</code> 指向父节点</li>
<li><code>child[2]</code> 指向两个子节点，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 是左儿子 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 是右儿子（没有子节点就指向空）</li>
<li><code>value</code> 即节点的权值（即需要维护其满足二叉查找树性质的值）</li>
<li><code>count</code> 即节点的值出现的次数（比如树中插入了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 次 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span></span></span></span> 那么 <code>value</code> 值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span></span></span></span> 的节点 <code>count</code> 就应该是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>）</li>
<li><code>size</code> 即节点的子树中所有值出现次数的和（或者说子树中所有节点的 <code>count</code> 和）</li>
</ol>
<p><strong>子节点方向</strong><br>
我也不知道怎么描述，意思就是 <code>son(p)</code> 返回的是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 是其父节点的哪个儿子，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 是左儿子 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 是右儿子。</p>
<p><strong>新节点</strong>：<br>
<code>newnode(f,v)</code> 指构造一个新的节点，其父节点为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span>，值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span>。</p>
<p><strong>连接</strong>：<br>
<code>connect(p,f,d)</code> 值将节点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 设为节点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> 的 <code>child[d]</code>。</p>
<p><strong>更新节点信息</strong><br>
<code>pushup(p)</code> 指通过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 的两个子节点来更新 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 的 <code>size</code>。</p>
<p>上面几个定义、操作都很简单，不作解释了，直接给出代码</p>
<pre><code class="language-cpp">int root,sum; // root 记根，sum 记已经用过的节点个数
struct NODE{int val,cnt,siz,fa,ch[2];}t[maxn]; // 节点的父子指针用数组模拟了
inline int newnode(int f,int v) {
    t[++sum].fa=f,t[sum].ch[0]=t[sum].ch[1]=0;
    t[sum].cnt=t[sum].siz=1,t[sum].val=v;
    return sum; // 返回的是新节点的编号
}
inline int son(int p) {return t[t[p].fa].ch[1]==p;}
inline void connect(int p,int f,int d) {t[p].fa=f,t[f].ch[d]=p;}
inline void pushup(int p) {t[p].siz=t[t[p].ch[0]].siz+t[t[p].ch[1]].siz+t[p].cnt;}
</code></pre>
<h2 id="旋转">旋转</h2>
<p>太多平衡树基于旋转了，旋转是这些平衡树最基础也是最重要的操作之一，所以这里先把它提出来单独讲。</p>
<h3 id="定义">定义</h3>
<p>我们先看旋转的定义。许多文献里将旋转分为左旋（zig）、右旋（zag），其实这样分是没有必要的，这里将全部归为一种 <code>rotate(p)</code>，表示的是将 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 转至其父节点的位置。</p>
<p>我们先看图：</p>
<figure data-type="image" tabindex="1"><img src="https://imzzy1201.github.io//post-images/1595065851730.svg" alt="" width="700" loading="lazy"></figure>
<p>图中 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A,B,C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> 所在的位置代表几个不知名的分别以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A,B,C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> 为根子树，旋转的过程并不会改变他们内部结构。<code>rotate(p)</code> 时，我们将 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 转到了原本 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> 所在的位置，而 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> 则代替 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 作为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 的一个子节点，而 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 则代替 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 作为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> 的一个子节点。</p>
<p>这样的旋转有两个重要的特征：一是仍然满足二叉查找树的性质，因为破坏二叉查找树的性质的方法是绝对不可取的，所以这一点异常重要；二是它会使得一些节点的深度增加，另一些节点深度减小，这个特征则保证了这个操作可以对树的平衡性作出贡献。</p>
<h3 id="实现">实现</h3>
<p>再来看实现：<br>
我们发现在 <code>rotate</code> 的过程中，有这三条边被砍断了：<br>
<img src="https://imzzy1201.github.io//post-images/1595066562276.svg" alt="" width="300" loading="lazy"><br>
砍断后成了这样：<br>
<img src="https://imzzy1201.github.io//post-images/1595066857558.svg" alt="" width="350" loading="lazy"><br>
取而代之的，是新连接的三条边 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>→</mo><mi>p</mi><mo separator="true">,</mo><mtext> </mtext><mi>p</mi><mo>→</mo><mi>f</mi><mo separator="true">,</mo><mtext> </mtext><mi>f</mi><mo>→</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">g\to p,\ p\to f,\ f\to B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span>：<br>
<img src="https://imzzy1201.github.io//post-images/1595067185921.svg" alt="" width="350" loading="lazy"><br>
在程序中，我们不需要体现“砍断”这个操作，因为“连接”的操作相当于已经先将原本的边砍断了。</p>
<p>所以我们先要这执行三次 <code>connect</code>，具体来说是若设旋转前的时候 <code>s1=son(p),s2=son(f)</code>，则我们需要执行 <code>connect(B,f,s1),connect(f,p,s1^1),connect(p,g,s2)</code>（其中 <code>^</code> 代表异或）</p>
<p>同时我们发现旋转之后 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> 的 <code>size</code> 会发生改变，所以要执行 <code>pushup(f),pushup(p)</code>（注意这里顺序不能颠倒）</p>
<p>给出 <code>rotate</code> 代码：</p>
<pre><code class="language-cpp">inline void rotate(int p) {
    int f=t[p].fa,g=t[f].fa,s1=son(p),s2=son(f);
    connect(t[p].ch[s1^1],f,s1),connect(f,p,s1^1),connect(p,g,s2);
    pushup(f),pushup(p); if(root==f) root=p;
}
</code></pre>
<h1 id="treap">Treap</h1>
<h2 id="思想">思想</h2>
<p>Treap 是由 Raimund G. Seidel 和 Cecilia Rodriguez Aragon 于 1989 年在他们的论文 &quot;<a href="http://faculty.washington.edu/aragon/pubs/rst89.pdf">Randomized Search Trees</a>&quot; 中最先提出的。其命名旨在“Tree+Heap”（这也充分体现了 Treap 的性质）。他们在这篇论文中对 Treap 的理论和实现有详尽的说明，对其复杂度也有严格证明。</p>
<p>Treap 的精髓在于多维护的一个值——优先级 （<code>pri</code>）。Treap 要求节点优先级满足堆的性质，正式是基于随机化的优先级，Treap 才有了期望 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的良好时间复杂度。</p>
<p>举个例子，下面的图里节点中黑色的数表示权值 <code>value</code>，旁边蓝色的数表示优先级 <code>pri</code>。其中只有第一棵树满足 Treap 的性质。<br>
<img src="https://imzzy1201.github.io//post-images/1595084592392.svg" alt="" loading="lazy"><br>
可以观察到</p>
<p>对于每个新插入的节点，Treap 都将赋予它一个随机优先级，Treap 先按照二叉查找树的正常方式插入这个节点，再通过一系列旋转操作来恢复 Treap 中优先级的堆性质。</p>
<p>虽说 Treap 是有可能退化为所有操作线性时间的，但因为随机化的保障，这的可能性微乎其微，而在大部分情况下 Treap 不仅能保证复杂度，而且常数还较小。</p>
<h2 id="实现-2">实现</h2>
<p>说说 Treap 的核心思想“通过一系列旋转操作来恢复 Treap 中优先级的堆性质”（这里将直接称其为“treap 操作”）。</p>
<p>其实 treap 操作很简单，假设我们插入到的这个节点为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span>，Treap 对优先级</p>
<h2 id="证明">证明</h2>

                        </div>
                        
                            <div class="post-toc">
                            	<a href="#" style="padding-left: 20px;">#</a>
                                <ul class="markdownIt-TOC">
<li><a href="#%E5%B9%B3%E8%A1%A1%E6%A0%91">平衡树</a></li>
<li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li>
<li><a href="#%E5%B9%B3%E8%A1%A1%E6%A0%91%E5%9F%BA%E7%A1%80">平衡树基础</a>
<ul>
<li><a href="#%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91">二叉查找树</a></li>
<li><a href="#%E6%97%8B%E8%BD%AC">旋转</a>
<ul>
<li><a href="#%E5%AE%9A%E4%B9%89">定义</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0">实现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#treap">Treap</a>
<ul>
<li><a href="#%E6%80%9D%E6%83%B3">思想</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0-2">实现</a></li>
<li><a href="#%E8%AF%81%E6%98%8E">证明</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>imzzy1201</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="https://imzzy1201.github.io/post/CtWUUv1It/">https://imzzy1201.github.io/post/CtWUUv1It/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://imzzy1201.github.io/post/CtWUUv1It/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://imzzy1201.github.io/post/CtWUUv1It/&sharesource=qzone&title=关于平衡树&pics=https://imzzy1201.github.io//images/avatar.png?v=1595751304641&summary=&lt;blockquote&gt;
&lt;p&gt;Never trouble trouble till trouble troubles you.&lt;/p&gt;
&lt;/blockquote&gt;
"><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=https://imzzy1201.github.io/post/CtWUUv1It/&sharesource=weibo&title=关于平衡树 + " - " + &lt;blockquote&gt;
&lt;p&gt;Never trouble trouble till trouble troubles you.&lt;/p&gt;
&lt;/blockquote&gt;
&pic="https://imzzy1201.github.io//images/avatar.png?v=1595751304641 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://imzzy1201.github.io/post/2rSfiSPRw/">
                                                                                            20200720 校内测试订正
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://imzzy1201.github.io/post/SJg1NdVND/">
                                                                                                    20200717 校内测试订正
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gitalk/gitalk/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/gh/gitalk/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width:60em;max-width: calc(min(max(100% - 42em, 640px),95%));margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '96f5be00e19e03f19687',
        clientSecret: 'e3027518b495d7487e5d1f416d1a4e1a5e035257',
        repo: 'comment',
        owner: 'imzzy1201',
        admin: ['imzzy1201'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        @imzzy1201.github.io<br> 

                            
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        imzzy1201&#39;s Blog &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by imzzy1201
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var pat = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + pat + '</div>')
                    </script>
        </footer>
        
                <script>
                    
                    
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1595751304641);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
                
        </div>
</body>
<script>
    scroll();
</script>

</html>